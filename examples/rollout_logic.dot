digraph RolloutLogic {
    rankdir=TB;
    node [shape=box, style=filled, fillcolor=white, fontname="Helvetica"];

    subgraph cluster_vllm {
        label = "vLLM Rollout (In-Process / Coupled)";
        style = filled;
        fillcolor = "#e3f2fd";

        V_RayWorker [label="Ray Worker Process\n(Hybrid Engine)", fillcolor="#bbdefb"];

        subgraph cluster_vllm_proc {
            label = "Worker Process Memory";
            style = dashed;
            color = "#1565c0";

            V_Engine [label="vLLM Engine\n(WorkerWrapperBase)", fillcolor="#90caf9"];
            V_Weights [label="Model Weights\n(Shared GPU Mem)", shape=cylinder, fillcolor="#ffe0b2"];
        }

        V_RayWorker -> V_Engine [label="ZMQ (IPC/TCP)\nRequests", dir=both];
        V_Engine -> V_Weights [label="Direct Access"];
    }

    subgraph cluster_trtllm {
        label = "TRT-LLM Rollout (Client-Server)";
        style = filled;
        fillcolor = "#f3e5f5";

        T_RayWorker [label="Ray Worker Process\n(Client)", fillcolor="#e1bee7"];

        subgraph cluster_trt_server {
            label = "TRT-LLM Server Process\n(Separate Actor)";
            style = dashed;
            color = "#7b1fa2";
            fillcolor = "#f3e5f5";

            T_Server [label="HTTP Server\n(OpenAIServer)", fillcolor="#ce93d8"];
            T_Weights [label="Engine Weights", shape=cylinder, fillcolor="#ffe0b2"];
        }

        T_RayWorker -> T_Server [label="HTTP (aiohttp)\nRequests", dir=both];

        T_RayWorker -> T_Weights [label="CUDA IPC\n(Weight Refit)", style=dotted, color="red"];
        T_Server -> T_Weights [label="Inference"];
    }
}
